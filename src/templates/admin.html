{% extends "base.html" %}

{% block title %}Área Administrativa - Ramalho Pet Shop Metas{% endblock %}

{% block content %}
<div class="admin-container card">
    <h2 class="card-header">Painel Administrativo (Master: {{ current_user.username }})</h2>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alerta alert-{{ category if category else 'info' }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <div class="admin-section">
        <h3>Gerenciar Metas Mensais</h3>
        <form method="POST" action="{{ url_for('main.upload_metas') }}" enctype="multipart/form-data">
            <div class="form-group">
                <label for="metas_file">Selecione a planilha de metas (.xlsx):</label>
                <input type="file" id="metas_file" name="metas_file" accept=".xlsx" required>
            </div>
            
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="mes_meta">Mês:</label>
                    <select id="mes_meta" name="mes_meta" class="form-control" required>
                        <option value="1">Janeiro</option>
                        <option value="2">Fevereiro</option>
                        <option value="3">Março</option>
                        <option value="4">Abril</option>
                        <option value="5">Maio</option>
                        <option value="6">Junho</option>
                        <option value="7">Julho</option>
                        <option value="8">Agosto</option>
                        <option value="9">Setembro</option>
                        <option value="10">Outubro</option>
                        <option value="11">Novembro</option>
                        <option value="12">Dezembro</option>
                    </select>
                </div>
                <div class="form-group col-md-6">
                    <label for="ano_meta">Ano:</label>
                    <select id="ano_meta" name="ano_meta" class="form-control" required>
                        <option value="2024">2024</option>
                        <option value="2025">2025</option>
                        <option value="2026">2026</option>
                    </select>
                </div>
            </div>
            
            <button type="submit" class="btn btn-principal">Enviar Planilha de Metas</button>
        </form>
        <p class="text-muted" style="margin-top: 10px;">A planilha deve seguir o formato do template fornecido, com abas nomeadas "Alvarenga", "Corbisier", "Piraporinha", contendo colunas "Dia" e "Meta".</p>
    </div>

    <hr style="margin: 30px 0;">

    <div class="admin-section">
        <h3>Metas Carregadas</h3>
        <div class="metas-carregadas">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Mês/Ano</th>
                        <th>Data de Upload</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    {% if metas_carregadas %}
                        {% for meta in metas_carregadas %}
                        <tr>
                            <td>{{ meta.mes_nome }} de {{ meta.ano }}</td>
                            <td>{{ meta.data_upload }}</td>
                            <td>
                                <a href="{{ url_for('main.visualizar_metas', mes=meta.mes, ano=meta.ano) }}" class="btn btn-sm btn-secundario">Visualizar</a>
                            </td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="3" class="text-center">Nenhuma meta carregada ainda.</td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>

    <hr style="margin: 30px 0;">

    <div class="admin-section">
        <h3>Outras Ações Administrativas</h3>
        <p><em>(Mais funcionalidades administrativas serão adicionadas aqui, como visualização de metas carregadas, edição manual, etc.)</em></p>
        <!-- Exemplo: Link para visualizar usuários -->
        <!-- <a href="{{ url_for("main.listar_usuarios") }}" class="btn btn-secundario">Gerenciar Usuários</a> -->
    </div>

</div>

<style>
.admin-container {
    max-width: 800px;
    margin: 2rem auto;
    padding: 2rem;
}
.admin-section {
    margin-bottom: 2rem;
}
.admin-section h3 {
    color: var(--cor-roxo-principal);
    margin-bottom: 1rem;
    border-bottom: 1px solid var(--cor-fundo-escuro);
    padding-bottom: 0.5rem;
}
.alert-danger {
    color: #721c24;
    background-color: #f8d7da;
    border-color: #f5c6cb;
    padding: .75rem 1.25rem;
    margin-bottom: 1rem;
    border: 1px solid transparent;
    border-radius: .25rem;
}
.alert-success {
    color: #155724;
    background-color: #d4edda;
    border-color: #c3e6cb;
    padding: .75rem 1.25rem;
    margin-bottom: 1rem;
    border: 1px solid transparent;
    border-radius: .25rem;
}
.form-row {
    display: flex;
    flex-wrap: wrap;
    margin-right: -5px;
    margin-left: -5px;
}
.col-md-6 {
    flex: 0 0 50%;
    max-width: 50%;
    padding-right: 5px;
    padding-left: 5px;
}
@media (max-width: 768px) {
    .col-md-6 {
        flex: 0 0 100%;
        max-width: 100%;
    }
}
</style>
{% endblock %}
